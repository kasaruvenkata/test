trigger: none

schedules:
  - cron: "0 9 * * 1"   # Monday 9 AM UTC
    always: true
    displayName: "Weekly File Summary"

pool:
  vmImage: ubuntu-latest

variables:
  S3_UAT_BUCKET: "aabackstop-uat"
  S3_PROD_BUCKET: "aabackstop-prod"
  AZURE_CONTAINER_UAT: "uat"
  AZURE_CONTAINER_PROD: "prod"
  EMAIL_TO: "ROAD_Ops_L2_Support@theaa.com"
  SECRET_NAME: "azneprod"
  AWS_REGION: "eu-west-1"
  MODE: "weekly"

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: "3.x"

- script: |
    pip install -r modules/lambda/MonitorLambda/requirements.txt
    python modules/lambda/MonitorLambda/monitor_lambda.py
  displayName: "Run Weekly Monitor"

- task: SendEmail@1
  inputs:
    To: "$(EMAIL_TO)"
    Subject: "âœ… Weekly File Transfer Summary"
    Body: |
      Please find below the weekly summary of files in Azure Blob and AWS S3.
    Attachments: "modules/lambda/MonitorLambda/weekly_report.txt"
